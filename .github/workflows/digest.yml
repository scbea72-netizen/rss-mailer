name: RSS Digest Mailer

on:
  schedule:
    # â° 45ë¶„ë§ˆë‹¤ ì‹¤í–‰ (ë¬´ë£Œ ë²ˆì—­ + ìºì‹œ ì•ˆì • ìµœì )
    - cron: "*/45 * * * *"
  workflow_dispatch:

concurrency:
  group: rss-digest-mailer
  cancel-in-progress: true

jobs:
  send-digest:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Restore cache (dedupe + title translate)
        uses: actions/cache@v4
        with:
          path: |
            .cache/rss
          key: rss-digest-cache
          restore-keys: |
            rss-digest-cache

      - name: Run digest
        env:
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          MAIL_TO:   ${{ secrets.MAIL_TO }}

          # ğŸ”§ ì•ˆì • ì˜µì…˜
          BATCH_WINDOW_SECONDS: "0"
          MAX_AGE_HOURS: "48"
          MAX_ITEMS_PER_FEED: "50"

          # ğŸ“¬ í•œ í†µ êµ¬ì„±
          MAX_ITEMS_PER_EMAIL: "120"
          MAX_US: "25"
          MAX_KR: "25"
          MAX_JP: "25"

          # ğŸŒ ì œëª© ë²ˆì—­(ë¬´ë£Œ)
          TITLE_TRANSLATE: "1"
          TITLE_TRANSLATE_PROVIDER: "mymemory"

          # ğŸ‡¯ğŸ‡µ ì¼ë³¸ ë‰´ìŠ¤ í•„í„° (ë§ì´ ë°›ìœ¼ë ¤ë©´ 0)
          JP_KEYWORD_MODE: "0"

          # ğŸ”— ìµœì¢… URL ì¶”ì  (ê¸°ë³¸ OFF)
          RESOLVE_FINAL_URL: "0"
        run: |
          python rss_digest.py
