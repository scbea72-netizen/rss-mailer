name: News Digest -> Hanmail

on:
  schedule:
    - cron: "*/45 * * * *"
  workflow_dispatch:

concurrency:
  group: news-digest-hanmail
  cancel-in-progress: true

jobs:
  send-digest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run rss digest
        env:
          # ✅ 한메일 전용 (지메일로 튀는 사고 방지)
          SMTP_HOST: "smtp.daum.net"
          SMTP_PORT: "465"
          SMTP_USER: ${{ secrets.HANMAIL_USER }}
          SMTP_PASS: ${{ secrets.HANMAIL_PASS }}
          MAIL_TO:   ${{ secrets.HANMAIL_TO }}
          MAIL_FROM: ${{ secrets.HANMAIL_FROM }}

          REQUEST_TIMEOUT: "15"
          MAX_AGE_HOURS: "48"
          MAX_ITEMS_PER_FEED: "50"

          MAX_ITEMS_PER_EMAIL: "120"
          MAX_US: "25"
          MAX_KR: "25"
          MAX_JP: "25"

          TITLE_TRANSLATE: "1"
          TITLE_TRANSLATE_PROVIDER: "mymemory"
          TRANSLATE_SLEEP_SECONDS: "1.0"
          JP_KEYWORD_MODE: "0"
          RESOLVE_FINAL_URL: "0"
        run: |
          python rss_digest.py
